### 计算字段
计算字段并不实际存在于数据库表中。
计算字段是运行时在SELECT 语句内创建的。
只有数据库知道SELECT 语句中哪些列是实际的表列，哪些列是计算字段。
从客户机（如应用程序）的角度来看，计算字段的数据是以与其他列的数据相同的方式返回的。

**拼接（concatenate）** 将值联结到一起构成单个值。  
多数DBMS使用+ 或|| 来实现拼接，MySQL则使用Concat() 函数来实现。  
`SELECT Concat(vend_name, ' (', vend_country, ')')
FROM vendors
ORDER BY vend_name;`  
拼接一个或多个指定的串，各个串之间用逗号分隔。

**别名 （alias）** 是一个字段或值的替换名。别名用AS 关键字赋予。  
用途：给计算字段命名；在实际的表列名包含不符合规定的字符（如空格）时重新命名它；在原来的名字含混或容易误解时扩充它，等等  
有时也称为导出列（derivedcolumn）  
例如：
`SELECT Concat(RTrim(vend_name), ' (', RTrim(vend_country), ')') AS
vend_title
FROM vendors
ORDER BY vend_name;`

|算数操作符|说明|
|----|----|
|+|加|
|-|减|
|* |乘|
|/ |除|

SELECT 提供了**测试和试验函数与计算**的一个很好的办法。虽然SELECT 通常用来从表中检索数据，但可以**省略FROM 子句**以便简单地访问和处理表达式。

### 函数
函数没有SQL的可移植性强。使用函数，应该保证做好代码注释。  
一般分为文本函数、数值函数、日期和时间函数、DBMS系统函数。
| 文本函数|说明|
| ---- | ---- |
|Left()|返回串左边的字符|
|Length()|返回串的长度|
|Locate()|找出串的一个子串|
|Lower()|将串转换为小写|
|LTrim()|去掉串左边的空格|
|Right()|返回串右边的字符|
|RTrim()|去掉串右边的空格|
|Soundex()[1]|返回串的SOUNDEX 值|
|SubString()|返回子串的字符|
|Upper()|将串转换为大写|

[1]SOUNDEX 是一个将任何文本串转换为描述其语音表示的字母数字模式的算法，使得可以对串进行发音比较而不是字母比较。

日期和时间采用相应的数据类型和特殊的格式存储，以便能快速和有效地排序或过滤，并且节省物理存储空间。  
|日期和时间函数	|说明|
|--|--|
|AddDate()	|增加一个日期（天、周等）|
|AddTime()	|增加一个时间（时、分等）|
|CurDate()	|返回当前日期|
|CurTime()	|返回当前时间|
|Date()	|返回日期时间的日期部分|
|DateDiff()	|计算两个日期之差|
|Date_Add()	|高度灵活的日期运算函数|
|Date_Format()	|返回一个格式化的日期或时间串|
|Day()	|返回一个日期的天数部分|
|DayOfWeek()	|对于一个日期，返回对应的星期几|
|Hour()	|返回一个时间的小时部分|
|Minute()	|返回一个时间的分钟部分|
|Month()|	返回一个日期的月份部分 |  
|Now()	|返回当前日期和时间|
|Second()	|返回一个时间的秒部分|
|Time()	|返回一个日期时间的时间部分|
|Year()	|返回一个日期的年份部分|

需要注意的是MySQL使用的日期格式。
1. 无论你什么时候指定一个日期，不管是插入或更新表值还是用WHERE 子句进行过滤，日期必须为格式yyyy-mm-dd，以排除多义性
2. 如果你想要的仅是日期，则使用Date() 是一个良好的习惯，即使你知道相应的列只包含日期也是如此。指示MySQL仅将给出的日期与列中的日期部分进行比较，而不是将给出的日期与整个列值进行比较。
3. BETWEEN 操作符可以用来定义一个要匹配的日期范围。

|数值处理函数	|说明|
|--|--|
|Abs()	|返回一个数的绝对值|
|Cos()	|返回一个角度的余弦|
|Exp()	|返回一个数的指数值|
|Mod()	|返回除操作的余数|
|Pi()	|返回圆周率|
|Rand()	|返回一个随机数|
|Sin()	|返回一个角度的正弦|
|Sqrt()	|返回一个数的平方根|
|Tan()	|返回一个角度的正切|

在主要DBMS的函数中，数值函数是最一致最统一的函数，但实际使用比前两种少。

### 聚集函数（aggregate function） 运行在行组上，计算和返回单个值的函数。
|聚集函数	|说明  |
|--|--|
|AVG()	|返回某列的平均值|
|COUNT()	|返回某列的行数|
|MAX()	|返回某列的最大值|
|MIN()	|返回某列的最小值|
|SUM()	|返回某列值之和|

**扩展：MySQL还支持一系列的标准偏差聚集函数**

AVG() 只能用来确定特定数值列的平均值，而且列名必须作为函数参数给出。为了获得多个列的平均值，必须使用多个AVG() 函数。且函数忽略列值为NULL 的行

COUNT() 函数有两种使用方式。
- 使用COUNT(* ) 对表中行的数目进行计数，不管表列中包含的是空值（NULL ）还是非空值。
- 使用COUNT(column) 对特定列中具有值的行进行计数，忽略NULL 值。

**在用于文本数据时，如果数据按相应的列排序，则MAX() 返回最后一行。** MAX() 函数忽略列值为NULL 的行。  
MIN() 的功能正好与MAX() 功能相反。在用于文本数据时，如果数据按相应的列排序，则MIN() 返回最前面的行。

利用标准的算术操作符，所有聚集函数都可用来执行多个列上的计算。

只包含不同的值，指定DISTINCT 参数。例如
`SELECT AVG(DISTINCT prod_price) AS avg_price
FROM products
WHERE vend_id = 1003;`
此时平均值只考虑不同的价格  
**DISTINCT 必须使用列名，不能用于计算或表达式。**

实际多用组合聚集函数。在指定别名以包含某个聚集函数的结果时，不应该使用表中实际的列名。

### 分组数据 SELECT 语句的GROUP BY 子句
分组允许把数据分为多个逻辑组，以便能对每个组进行聚集计算。

**GROUP BY 子句的重要的规定：**
- GROUP BY 子句可以包含任意数目的列。这使得能对分组进行嵌套，为数据分组提供更细致的控制。
- 如果在GROUP BY 子句中嵌套了分组，数据将在最后规定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据）。
- GROUP BY 子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT 中使用表达式，则必须在GROUP BY 子句中指定相同的表达式。不能使用别名。
- 除聚集计算语句外，SELECT 语句中的每个列都必须在GROUP BY 子句中给出。
- 如果分组列中具有NULL 值，则NULL 将作为一个分组返回。如果列中有多行NULL 值，它们将分为一组。
- GROUP BY 子句必须出现在WHERE 子句之后，ORDER BY 子句之前。

 使用WITH ROLLUP 关键字，可以得到每个分组汇总值，并且**在分组统计数据的基础上再进行统计汇总**。
 
 **WHERE VS HAVING：**
 - WHERE 过滤行，而HAVING 过滤分组
 - 另一种理解方法，WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤。这是一个重要的区别，WHERE 排除的行不包括在分组中。这可能会改变计算值，从而影响HAVING 子句中基于这些值过滤掉的分组。

一般在使用GROUP BY 子句时，应该也给出ORDER BY 子句。这是保证数据正确排序的唯一方法。
 
